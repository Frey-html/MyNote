`new` 和 `delete` 以及 `malloc` 和 `free` 都是用于动态内存分配和释放的，但它们之间有几个重要的区别：
#review
### 1. **类型安全**

- **`new` 和 `delete`**:
  - `new` 返回所分配内存的类型指针，具有类型安全性。
  - 示例：
    ```cpp
    int* p = new int; // 返回 int* 类型
    ```

- **`malloc` 和 `free`**:
  - `malloc` 返回 `void*`，需要显式转换为所需类型，缺乏类型安全性。
  - 示例：
    ```cpp
    int* p = (int*)malloc(sizeof(int)); // 需要手动类型转换
    ```

### 2. **构造和析构**

- **`new` 和 `delete`**:
  - `new` 调用对象的构造函数，`delete` 调用对象的析构函数。
  - 示例：
    ```cpp
    MyClass* obj = new MyClass(); // 调用构造函数
    delete obj;                   // 调用析构函数
    ```

- **`malloc` 和 `free`**:
  - `malloc` 仅分配内存，不调用构造函数；`free` 也不调用析构函数。
  - 示例：
    ```cpp
    MyClass* obj = (MyClass*)malloc(sizeof(MyClass)); // 不调用构造函数
    free(obj);                                         // 不调用析构函数
    ```

### 3. **内存分配方式**

- **`new` 和 `delete`**:
  - 分配的内存块通常是初始化的，并且内存分配会在对象的上下文中处理。

- **`malloc` 和 `free`**:
  - `malloc` 分配的内存未初始化，分配的内存块是原始内存状态。

### 4. **使用方法**

- **`new` 和 `delete`**:
  - 用于对象和类的动态内存管理。
  - 支持数组分配（`new[]` 和 `delete[]`）。

- **`malloc` 和 `free`**:
  - 用于更低层次的内存管理，通常用于 C 语言中的内存管理。
**注意** 如果你为数组使用了 `delete` 而不是 `delete[]`，只有第一个元素的内存会被释放，其它元素将不会被正确销毁和释放。这是一个常见的错误，会导致内存泄漏或其他内存问题。

### 5. **异常处理**

- **`new` 和 `delete`**:
  - 如果内存分配失败，`new` 会抛出 `std::bad_alloc` 异常。
  - 可以使用 `new(nothrow)` 来返回 `nullptr` 而不是抛出异常。

- **`malloc` 和 `free`**:
  - 如果内存分配失败，`malloc` 会返回 `nullptr`，需要手动检查返回值。

### 总结

- 使用 `new` 和 `delete` 更适合 C++，因为它们支持构造和析构以及类型安全性。
- `malloc` 和 `free` 更适合 C 语言，但在 C++ 中使用时需要小心，因为它们不处理对象的生命周期。 



### 补充：new与delete工作原理
当你使用 `new` 分配内存时，以下两件事情会发生：

1. **内存分配**：程序会向操作系统请求分配一块内存，大小由类型的大小决定（例如，一个 `int` 通常占 4 字节）。
2. **调用构造函数**：如果是一个类对象，`new` 会自动调用类的构造函数来初始化对象。

使用 `delete` 时，以下两件事发生：

1. **调用析构函数**：如果是类对象，`delete` 会首先调用类的析构函数，释放资源。
2. **内存释放**：程序会将内存返回给操作系统，供未来的内存请求使用。

#### 注意事项



- **多次释放同一块内存**：这是未定义行为。不要尝试对已经释放的指针再次调用 `delete`。
  
  ```cpp
  int* ptr = new int(10);
  delete ptr;
  delete ptr;  // 错误：多次删除同一个指针，导致未定义行为
  ```

- **释放空指针**：释放空指针（`nullptr`）是安全的，不会发生任何事情。
  
  ```cpp
  int* ptr = nullptr;
  delete ptr;  // 安全，无操作发生
  ```

- **避免悬空指针**：释放内存后，不要继续使用该指针，否则会引发悬空指针问题。可以将指针设为 `nullptr` 来防止这种情况。

  ```cpp
  int* ptr = new int(10);
  delete ptr;
  ptr = nullptr;  // 防止悬空指针
  ```

