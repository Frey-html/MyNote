#### 培训1
* 并行编程与gpu编程模型
* 理解GPU Shader Hardware概念

* GPGPU 通用gpu，没有图形管线，没有几何计算和光栅化，增加了更多计算单元（更多SIMD core），适用于人工智能的并行计算


![[95c423deac5f9ed37dc79c0b109df93a.jpg]]
* 程序如何在GPU上运行：
	* MACA:沐曦开发的CUDA替代
	* 核函数才是跑在gpu上的内容，其他跑在cpu上，利用异步编程。在cpu编程部分利用api分配空间，拷贝内存至gpu，调用核函数。在gpu运行完成后再将gpu device上的结果拷贝到cpu上验证。
	* Grid - WorkGroup（ThreadBlock）- WorkItem（Thread和软件线程不是一个概念）
	   Wave/Warp 在硬件处理时以多少WorkItem（Thread）为单位来处理。在沐曦的架构里，一条指令可以处理64个thread，绑定到一个寄存器组里，将处理一组thread的行为称为Wave/Warp
	 * STREG（single thread register）与 MTREG（multi thread Register） XMSK(ExecutionMusk)控制SIMD指令中寄存器每一thread是否执行操作
	![[lQDPJxBI-LoeZvjNAj7NBP-wxMHQhvCtVwIFLE1ZZMxSAA_1279_574.jpg]]
	* 一个GPU里面设计了8个相同的DPC负责完成任务，可以被阉割。同一个WorkGrop中的多个Wave会被分给一个DPC中的同一个AP中多次执行![[lQDPJwIS_h5C4tjNAj7NBP-wtIFIEsGXdZ0FLE62452yAA_1279_574.jpg]]
	* Shader subsystem：ISU(Instruction scheduler) PEU（Processor element）SL1(Scalar L1  cache) WSM（workgroup shared memory） VLS（vector load / store）类似五级流水cpu架构![[lQDPJx8ZkHv7ytjNAj7NBP-wmYZzdxkEKgUFLE82Ky4tAA_1279_574.jpg]]![[lQDPJwTqlqjRIRjNAj7NBP-wddAuVgKLrFYFLE_mc4k3AA_1279_574.jpg]]![[lQDPJxvwHUznBljNAj7NBP-w2p15y97E55gFLFBKjmofAA_1279_574.jpg]]L2是内存，先读到L1缓存中再读到ap中

#### CLF模块
![[75b46489432d2133a0999fef586074bb.jpg]]![[afa737a51c790d183b11f2a972844173.jpg]]![[4dd2fd424a16214626c32714a313bea3.jpg]]![[23927684f78f2eff387c570ba152d69a.jpg]]
#### 培训2 1st Triangle 
[GPU Rendering Pipeline——GPU渲染流水线简介 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/61949898)

VS+PS硬件流程图：
![[Pasted image 20231108162116.png]]
CE: 取cpu command
GFD：将图元信息进行分类标号
GFP: 将不同信息从memory等存储放进内部，将vertex信息发送给CPA
RM：分配shader操作的模块，将不同任务进行累积后发送
PSO：整理textrue buffe的数据
XPF：进行alpha test等以及blending，之后发送到显存

Interpreter TEST跑法![[70152b0abf14bc099ec3806faf1c1caa.jpg]]![[lQDPJyCpviTrqXTNAj7NBP-wxaXpSQ--DwsFPSHhdqv1AA_1279_574.jpg]]
-w 生成并查看test的图像 -o 在相应文件夹下生成图像
通过test和vk的结果对比验证test编写正确性
itrace.txt 指令执行过程中的打印log 可以在其中查找image_sample指令查看跑的类型![[lQDPJxxB-CMxljTNAj7NBP-w8M-bVpHnPrEFPSLes7x0AA_1279_574.jpg]] 


#### DPF模块LateZ pipeline
![[D006EE5E-98F6-4cf8-AADD-D60AFE9C76AD.png]]![[ABB12E9E-B161-4651-B4DD-54A27B8EBC0A.png]]
#### 调试Blending和frambuffer
* 编译Cmodel Toyifei_build.sh
* 调试case的路径 test/regression-case/funccoverage/Framebuffer
* 调试思路：先出图与golden对比，然后看二进制文件对比，再用vscode debug具体代码（此时主要问题会在formart或者其他组的函数）
![[lQLPJwz7JGFTRVTNAXTNAemwnQ4sTYk8ha8FQ4Fs_AD6AA_489_372.png]]